## [CPP] æ„é€ ä¸ææ„

æœ¬æ–‡å¯¹ C++ ä¸­å¯¹æ„é€ ä¸ææ„å‡½æ•°åšä¸€æ¬¡æ€»ç»“ã€‚

## æ„é€ å‡½æ•°

+ ç»§æ‰¿ï¼šå…ˆçˆ¶åå­ã€‚å¦‚æœç»§æ‰¿é“¾ä¸º `A->B->C` ï¼Œé‚£ä¹ˆä¸€æ¬¡æ‰§è¡Œ ABC çš„æ„é€ å‡½æ•°ã€‚

```cpp
#include <iostream>
using namespace std;
class A
{
public:
    A() { cout << "A "; }
};
class B : public A
{
public:
    B() { cout << "B "; }
};
class C : public B
{
public:
    C() { cout << "C "; }
};
int main()
{
    C c;
}
// è¾“å‡ºï¼šA B C
```

+ å¯¹è±¡ç»„åˆï¼šå‡å¦‚ `A` çš„æˆå‘˜åŒ…å« `A1, A2` ä¸¤ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆå…ˆæ‰§è¡Œæˆå‘˜å˜é‡çš„ã€‚

```cpp
#include <iostream>
using namespace std;
class A1
{
public:
    A1() { cout << "A1 "; }
};
class A2
{
public:
    A2() { cout << "A2 "; }
};
class A
{
public:
    A1 a1;
    A2 a2;
    A() { cout << "A "; }
};
int main()
{
    A a;
}
// è¾“å‡ºï¼šA1 A2 A
```

æ€»ç»“ï¼šæ„é€ é¡ºåºæ€»æ˜¯**æŒ‰ä½“ç§¯ä»å°åˆ°å¤§** ã€‚ä¾‹å¦‚ï¼Œåœ¨ç»§æ‰¿ä¸­ï¼Œçˆ¶ç±»çš„ã€Œä½“ç§¯ã€ä¸€èˆ¬æ¯”å­ç±»å°ï¼ˆå› ä¸ºå­ç±»åŒ…å«æ›´å¤šçš„ä¿¡æ¯ï¼‰ï¼›åœ¨å¯¹è±¡ç»„åˆä¸­ï¼Œæˆå‘˜å˜é‡ä¸­çš„å¯¹è±¡çš„ä½“ç§¯è‡ªç„¶æ¯”æ•´ä¸ªå¯¹è±¡è¦ã€Œå°ã€ã€‚

## ææ„å‡½æ•°

æ™®é€šæƒ…å†µï¼šå…ˆæ„é€ åææ„ï¼Œå³ **ä¸æ„é€ é¡ºåºç›¸å**ã€‚

**âš ï¸ç‰¹æ®Šæƒ…å†µï¼šå…¨å±€å˜é‡ï¼Œå±€éƒ¨ `static` å˜é‡ï¼Œæ™®é€šå±€éƒ¨å˜é‡åŒæ—¶å‡ºç°ã€‚**ç›´æ¥çœ‹ä¸‹é¢ã€Œç‰¹æ®Šæƒ…å†µã€ä¸€èŠ‚å³å¯ã€‚

### æŒ‰ç…§å¯¹è±¡å…³ç³»åˆ†ç±»

+ ç»§æ‰¿å…³ç³»

```cpp
class A
{
public:
    A() { cout << "A "; }
    ~A() { cout << "~A "; }
};
class B : public A
{
public:
    B() { cout << "B "; }
    ~B() { cout << "~B "; }
};
class C : public B
{
public:
    C() { cout << "C "; }
    ~C() { cout << "~C "; }
};
int main()
{
    C c;
}
// è¾“å‡ºï¼šA B C ~C ~B ~A 
```

+ å¯¹è±¡ç»„åˆ

```cpp
class A1
{
public:
    A1() { cout << "A1 "; }
    ~A1() { cout << "~A1 "; }
};
class A2
{
public:
    A2() { cout << "A2 "; }
    ~A2() { cout << "~A2 "; }
};
class A
{
public:
    A1 a1;
    A2 a2;
    A() { cout << "A "; }
    ~A() { cout << "~A "; }
};
int main()
{
    A a;
}
// Output: A1 A2 A ~A ~A2 ~A1 
```



### æŒ‰ç…§å¯¹è±¡æ‰€åœ¨å­˜å‚¨åŒºåŸŸåˆ†ç±»

+ **åœ¨æ ˆä¸Š**ï¼š

```cpp
void func()
{
	A a;
	B b;
	C c;
}
```

é‚£ä¹ˆï¼Œæ„é€ é¡ºåºï¼š`a -> b -> c`ï¼Œææ„é¡ºåºä¸ºï¼š`c -> b -> a` .

å¦‚æœä½¿ç”¨ `new` å…³é”®å­—ï¼Œè¾“å‡ºä¸å˜ï¼ˆå †å…¶å®æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ ˆåŒºåŸŸï¼‰ã€‚

+ **åœ¨å…¨å±€/é™æ€å­˜å‚¨åŒº**

C/C++ ä¸­å®šä¹‰çš„**å…¨å±€å˜é‡**ï¼Œæˆ–è€…**ä½¿ç”¨ `static` ä¿®é¥°çš„å±€éƒ¨å˜é‡**ï¼Œéƒ½ä¼šå­˜å‚¨åœ¨ä¸€ä¸ªå«ã€Œå…¨å±€/é™æ€å­˜å‚¨åŒºã€çš„åœ°æ–¹ï¼ˆå³ `DATA` æ•°æ®æ®µï¼‰ã€‚

ä¾‹å¦‚ï¼š

```cpp
A a;
B b;
C c;
int main(){}
// Output: A B C ~C ~B ~A
```

ä¾æ—§éµå¾ªã€Œå…ˆæ„é€ åææ„ã€çš„è§„åˆ™ã€‚

### ç‰¹æ®Šæƒ…å†µ

ä½†æ˜¯å¦‚æœæ—¢æœ‰æ™®é€šå˜é‡ï¼Œåˆæœ‰å…¨å±€å˜é‡ï¼Œè¿˜æœ‰ `static` å±€éƒ¨å˜é‡ï¼Œé‚£ä¹ˆå°±æœ‰ç‚¹æå¤´äº†ã€‚

```cpp
C c;
int main()
{
    A *pa = new A();
    B b;
    static D d;
    delete pa;
}
```

æ„é€ é¡ºåºï¼š`c -> a -> b -> d`ï¼Œææ„é¡ºåºï¼š`~A -> ~B -> ~D -> ~C` .

è¿™ç§æƒ…å†µä¸ç¬¦åˆä¸Šè¿°è§„åˆ™ã€‚åŸå› ï¼šæ ˆä¸Šçš„å˜é‡æ˜¯ä»£ç å—ç»“æŸçš„æ—¶å€™é‡Šæ”¾ï¼Œå…¨å±€/é™æ€æ•°æ®åŒºçš„å˜é‡æ˜¯ **ç¨‹åºç»“æŸæ—¶** æ‰é‡Šæ”¾ã€‚ **`main` å‡½æ•°ç»“æŸæ—¶ï¼Œç¨‹åºè¿˜æ²¡ç»“æŸã€‚**

é€è¡Œä»£ç ä»£ç çœ‹ï¼Œæ„é€ é¡ºåºæ˜¯æ¯«æ— ç–‘é—®çš„ã€‚å½“è¿è¡Œè‡³ç¬¬ 6 è¡Œä»£ç æ—¶ï¼Œå†…å­˜çŠ¶æ€å¦‚ä¸‹ï¼š

```
|  b |   d    |
|  a |   c    |
|å †/æ ˆ|å…¨å±€/é™æ€|
```

æ‰§è¡Œè‡³ç¬¬ 7 è¡Œï¼šé‡Šæ”¾ A ã€‚

æ‰§è¡Œè‡³ç¬¬ 8 è¡Œï¼šé‡Šæ”¾ B ã€‚

è¿”å›åˆ°æ‰§è¡Œ `main` å‡½æ•°çš„ä½ç½®ï¼ˆæœ‰äº›æ±‡ç¼–ä¸­ä½¿ç”¨ç¬¦å· `__start` æˆ–è€… `__init` æ¥æ ‡è®° ï¼‰ï¼šä¾æ¬¡é‡Šæ”¾ D å’Œ C ã€‚

> ğŸ’¬ ä¸€ä¸ªæœ‰è¶£çš„é—®é¢˜ï¼š `main` å‡½æ•°ä¹‹å‰å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ
>
> åœ¨è¿™é‡Œï¼Œåœ¨ `main` å‡½æ•°æ‰§è¡Œå‰ï¼Œå…¨å±€å˜é‡ä¸­çš„å¯¹è±¡**åº”è¯¥ä¸”å¿…é¡»å®Œæˆåˆå§‹åŒ–**ã€‚é‚£ä¹ˆè¿™ä¸ªåˆå§‹åŒ–åŠ¨ä½œç”±è°æ¥å®Œæˆçš„å‘¢ï¼Ÿæˆ‘ä»¬çŒœæ˜¯ `main` çš„è°ƒç”¨è€…æ¥å®Œæˆçš„ï¼Œå­¦è¿‡ ICS/CSAPP è¿™é—¨è¯¾çš„è¯ï¼Œåº”è¯¥çŸ¥é“ï¼Œåœ¨ IA32 å½“ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ª `__start/__init` å‡½æ•°ä½äº `main` çš„æ›´é«˜ä¸€å±‚ï¼Œå¯¹ç¨‹åºçŒ¿ä¸å¯è§ã€‚
>
> è‡³äºç¨‹åºç¬¬ä¸€è¡Œæ‰§è¡Œçš„ä»£ç æ˜¯ä»€ä¹ˆï¼Ÿè¿™å°±æ˜¯ä¸€ä¸ªæ›´å€¼å¾—æ¢ç©¶çš„é—®é¢˜äº†ï¼ˆå¯æƒœæˆ‘ä¸ä¼šğŸ˜…ã€‚

## æ‹·è´æ„é€ å‡½æ•°ä¸èµ‹å€¼è¿ç®—ç¬¦é‡è½½

å…ˆçœ‹ä¸€æ®µä»£ç ï¼š

```cpp
#include<iostream>
using namespace std;
class MyClass
{
public:
    MyClass(int i = 0)
    {
        cout << i;
    }
    MyClass(const MyClass &x)
    {
        cout << 2;
    }
    MyClass &operator=(const MyClass &x)
    {
        cout << 3;
        return *this;
    }
    ~MyClass()
    {
        cout << 4;
    }
};
int main()
{
    MyClass obj1(1), obj2(2);
    MyClass obj3 = obj1;
    return 0;
}
// Outputï¼š122444
```

è§£æï¼š

```
MyClass obj3 = obj1; 
obj3 è¿˜ä¸å­˜åœ¨ï¼Œæ‰€ä»¥è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°è¾“å‡º2ï¼Œ
å¦‚æœ obj3 å­˜åœ¨ï¼Œobj3=objï¼Œåˆ™è°ƒç”¨å¤åˆ¶è¿ç®—ç¬¦é‡è½½å‡½æ•°ï¼Œè¾“å‡º3 
```

OSï¼šTMD è¿™éƒ½ä»€ä¹ˆç ´é¢è¯•é¢˜ï¼Œæ‹›çš„è¯­è¨€å¾‹å¸ˆè¿˜æ˜¯å’‹æ»´ï¼Œäººæ™•äº†ã€‚