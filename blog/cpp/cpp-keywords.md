## C++ Keywords

æœ¬æ–‡æ˜¯å…³äº C++ çš„å­¦ä¹ ç¬”è®°ï¼Œä¸»è¦å†…å®¹æ˜¯ C++ ä¸­å…³é”®å­—çš„å‰–æã€‚

## sizeof

### sizeof åœ¨æ•°ç»„ä¸­çš„å‘

ä¼—æ‰€å‘¨çŸ¥ï¼Œ`sizeof` ç”¨äºè·å–æŸä¸ªå˜é‡/æ•°ç»„çš„å­—èŠ‚æ•°ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå…³äº `sizeof` çš„å‘ï¼š

```cpp
void test2()
{
    auto func = [](char str[]) {
        cout << sizeof(str) << endl;
    };
    char str[] = "12";
    cout << sizeof(str) << endl;
    func(str);
}
// 64ä½æœºå™¨ä¸Šè¾“å‡ºï¼š3 8
```

è¿™ç¬¬ä¸€æ¬¡é‡è§å±å®æœ‰äº›çº³é—·ï¼Œæˆ‘åŸæœ¬æƒ³åº”è¯¥æ˜¯è¾“å‡ºæ•°ç»„çš„å­—èŠ‚æ•°æ‰å¯¹ï¼Œç­‰æˆ‘ä½¿ç”¨ `g++ -std=c++17 ` ç¼–è¯‘ï¼Œç»“æœæœ‰ä¸€ä¸ª `warning` : 

```
warning: sizeof on array function parameter will return size of 'char *' instead of 'char []'
    auto func = [](char str[]) { cout << sizeof(str) << endl; };
```

åº”è¯¥éƒ½è¯»å¾—æ‡‚è‹±æ–‡å§ï¼ˆæ‘Šæ‰‹ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ`char str[]` è¢«ç¼–è¯‘å™¨è½¬æ¢ä¸º `char *` äº†ã€‚

### sizeof å’Œç±»

æ¥è‡ªã€Šå‰‘æŒ‡ Offer ã€‹ä¸€ä¹¦ã€‚

1. å®šä¹‰ä¸€ä¸ªç©ºç±» `A` ï¼Œæ²¡æœ‰æˆå‘˜å˜é‡å’Œå‡½æ•°ï¼Œ`sizeof(A)` æ˜¯å¤šå°‘ï¼Ÿæ˜¯ 0 å—ï¼Œä¸ºä»€ä¹ˆï¼Ÿ

ç­”ï¼šè‡³å°‘ä¸º 1. å› ä¸ºç©ºç±»å‹çš„å®ä¾‹ä¸åŒ…å«ä»»ä½•ä¿¡æ¯ï¼Œæœ¬è¦æ±‚ `sizeof(A)` æ˜¯ 0 çš„ï¼Œä½†æ˜¯å½“æˆ‘ä»¬å£°æ˜è¿™ä¸ªç±»å‹çš„å®ä¾‹æ—¶ï¼Œå®ƒå¿…é¡»åœ¨å†…å­˜ä¸­å æ®ä¸€å®šç©ºé—´ï¼ˆæˆ–è€…è¯´å¿…é¡»è¦åˆ†é…ä¸€ä¸ªå†…å­˜åœ°å€ï¼‰ï¼Œå¦åˆ™æ— æ³•ä½¿ç”¨è¿™ä¸ªå®ä¾‹ã€‚å› æ­¤ç©ºç±»å‹çš„å¤§å°è‡³å°‘ä¸º 1 ï¼Œå…·ä½“ç”±ç¼–è¯‘å™¨æ¥å†³å®šã€‚

2. å¦‚æœåŠ å…¥æ„é€ ä¸ææ„å‡½æ•°å‘¢ï¼Ÿ

ç­”ï¼šè¿˜æ˜¯ 1 . è°ƒç”¨å‡½æ•°åªéœ€è¦çŸ¥é“è¿™ä¸ªå‡½æ•°çš„åœ°å€å³å¯ï¼Œè¿™äº›åœ°å€åªå’Œ**ç±»å‹**ç›¸å…³ï¼Œè€Œä¸**ç±»çš„å®ä¾‹**æ— å…³ã€‚ç¼–è¯‘å™¨ä¸ä¼šå› ä¸ºæˆå‘˜å‡½æ•°åœ¨ç±»çš„å®ä¾‹ä¸­æ·»åŠ é¢å¤–ä¿¡æ¯ã€‚

3. å¦‚æœææ„å‡½æ•°æ ‡è®°ä¸ºè™šå‡½æ•°å‘¢ï¼Ÿ

ç­”ï¼š32 ä½æœºå™¨ä¸Šæ˜¯ 4ï¼Œ64 ä½æœºå™¨ä¸Šæ˜¯ 8ã€‚ç¼–è¯‘å™¨å¦‚æœå‘ç°ä¸€ä¸ªç±»ä¸­æœ‰è™šå‡½æ•°ï¼Œå°±ä¼šä¸ºè¯¥ç±»å‹ç”Ÿæˆä¸€ä¸ª**è™šå‡½æ•°è¡¨**ï¼Œå¹¶åœ¨æ¯ä¸€ä¸ªå®ä¾‹ä¸­æ·»åŠ ä¸€ä¸ª**æŒ‡å‘è™šå‡½æ•°è¡¨çš„æŒ‡é’ˆ**ã€‚

## static

è€ç”Ÿå¸¸è°ˆçš„ DATA æ®µå’Œ BSS æ®µï¼ˆåˆç§°ã€Œå…¨å±€é™æ€å­˜å‚¨åŒºã€ï¼‰ï¼š

1. DATA æ®µï¼ˆå…¨å±€åˆå§‹åŒ–åŒºï¼‰å­˜æ”¾åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ã€‚
2. BSS æ®µï¼ˆå…¨å±€æœªåˆå§‹åŒ–åŒºï¼‰å­˜æ”¾æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ï¼Œåœ¨ç¨‹åºæ‰§è¡Œä¹‹å‰ä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨æ¸… 0 ã€‚

static çš„ä½œç”¨ï¼š

- ä¿®é¥°å˜é‡
  - ä¿®é¥°å±€éƒ¨å˜é‡ï¼šåœ¨ä¿®é¥°å˜é‡çš„æ—¶å€™ï¼Œstatic ä¿®é¥°çš„é™æ€å±€éƒ¨å˜é‡åªæ‰§è¡Œåˆå§‹åŒ–ä¸€æ¬¡ï¼Œè€Œä¸”å»¶é•¿äº†å±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸï¼Œç›´åˆ°ç¨‹åºè¿è¡Œç»“æŸä»¥åæ‰é‡Šæ”¾ã€‚
  - ä¿®é¥°å…¨å±€å˜é‡ï¼šstatic ä¿®é¥°å…¨å±€å˜é‡çš„æ—¶å€™ï¼Œè¿™ä¸ªå…¨å±€å˜é‡åªèƒ½åœ¨æœ¬æ–‡ä»¶ä¸­è®¿é—®ï¼Œä¸èƒ½åœ¨å…¶å®ƒæ–‡ä»¶ä¸­è®¿é—®ï¼Œå³ä¾¿æ˜¯ extern å¤–éƒ¨å£°æ˜ä¹Ÿä¸å¯ä»¥ã€‚

- ä¿®é¥°å‡½æ•°ï¼šstatic ä¿®é¥°ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™è¿™ä¸ªå‡½æ•°çš„åªèƒ½åœ¨æœ¬æ–‡ä»¶ä¸­è°ƒç”¨ï¼Œä¸èƒ½è¢«å…¶ä»–æ–‡ä»¶è°ƒç”¨ã€‚

- ä¿®é¥°ç±»çš„æˆå‘˜å˜é‡ï¼šå¤šä¸ªå¯¹è±¡å¯ä»¥å…±äº«è¿™ä¸€å˜é‡

- ä¿®é¥°ç±»çš„æˆå‘˜å‡½æ•°ï¼šä¸éœ€è¦å…·ä½“çš„å®ä¾‹å¯¹è±¡ä¹Ÿèƒ½è°ƒç”¨ï¼Œé€šè¿‡åŸŸæ“ä½œç¬¦ `ClassName::funcName();` .

  



## const

ä½œç”¨ï¼š

- ä¿®é¥°åŸºæœ¬ç±»å‹å˜é‡ã€‚å¦‚ `const int x = 1;` ï¼Œä¸èƒ½å¯¹ `x` è¿›è¡Œèµ‹å€¼æ“ä½œã€‚
- ä¿®é¥°ç±»å˜é‡ã€‚å‚è€ƒä¸‹é¢ã€Œconst ä¸ ç±»ã€ã€‚
- ä¿®é¥°å‡½æ•°
  - ä¿®é¥°è¿”å›å€¼ `const int func() {}` ï¼š æ²¡æœ‰æ„ä¹‰ã€‚
  - ä¿®é¥°å‡½æ•°ä½“ `int func() const {}` :  å½“ä¸”ä»…å½“ `func` æ˜¯ç±»çš„æˆå‘˜å‡½æ•°æ‰èƒ½è¿™æ ·ä½¿ç”¨ï¼Œè¿™æ ·çš„ `const` è¡¨ç¤ºä¸å…è®¸ `func` ä¿®æ”¹ä»»ä½•æˆå‘˜å˜é‡ã€‚

### const ä¸æŒ‡é’ˆ

const ä¸æŒ‡é’ˆçš„ç»„åˆæœ‰ 4 æƒ…å†µï¼š

```cpp
const int* s;        // ä¿®é¥° int*, æŒ‡å‘çš„å†…å­˜ä¸å¯å˜ï¼Œs çš„æŒ‡å‘å¯å˜
int const *s;        // åŒä¸Šï¼Œå¥‡è‘©å†™æ³•
int* const s;        // ä¿®é¥° s, æŒ‡å‘çš„å†…å­˜å¯å˜ï¼Œs çš„æŒ‡å‘ä¸å¯å˜
const int* const s;  // æŒ‡å‘çš„å†…å­˜ä¸å¯å˜ï¼Œs çš„æŒ‡å‘ä¸å¯å˜
```

const çš„ä¿®é¥°å¯¹è±¡æ˜¯ã€Œå‘å³å°±è¿‘åŸåˆ™ã€ã€‚ä¸èƒ½ç†è§£çš„è¯ï¼Œè¿˜å¯ä»¥è¿™ä¹ˆè¯´ï¼š

+ å¦‚æœ `*` ä½äº const çš„å³ä¾§ï¼Œé‚£ä¹ˆæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ä¸å¯å˜ã€‚
+ å¦‚æœ `*` ä½äº const çš„å·¦ä¾§ï¼Œé‚£ä¹ˆæŒ‡é’ˆå˜é‡æœ¬èº«ä¸å¯å˜ã€‚

å‡½æ•°å‚æ•°å‡ºç°è¿™å‡ ç§æƒ…å†µçš„æ—¶å€™åŒç†ã€‚ä¸€ç§å¸¸è§çš„ç”¨æ³•å°±æ˜¯ä¿è¯ä¼ å…¥çš„å‚æ•°ä¸è¢«æ”¹å˜ï¼Œå¢å¼ºä»£ç å®‰å…¨æ€§ã€‚

```cpp
void f1(const int x)  {...}  // x çš„å€¼ä¸å¯å˜
void f2(int* const p) {...}  // p çš„æŒ‡å‘ä¸å¯å˜ï¼Œä¸ä¸ŠåŒç†
```

å¯¹äºå¼•ç”¨ `&` æ¥è¯´ï¼ˆå› ä¸ºå¼•ç”¨æœ¬èº«ä¸å¯è¢«èµ‹å€¼ï¼‰ï¼Œå°±è¦ç®€å•ä¸€äº›ï¼š

```cpp
void f1(const vector<int> &v) {...}  // v ä¸å¯å˜
void f2(vector<int> const &v) {...}  // åŒä¸Šï¼Œv ä¸å¯å˜
void f3(vector<int>& const v) {...}  // é”™è¯¯å‡½æ•°å®šä¹‰
```



**ä»£ç æ ·ä¾‹**

```cpp
#include <iostream>
#include <vector>
using namespace std;
void f1(const vector<int> &v)
{
    // v.push_back(1);  // error
}
void f2(vector<int> const &v)
{
    // v.push_back(1);  // error
}
// void f3(vector<int>& const v) {} // error

int main()
{
    int k = 1;
    const int *p1 = &k;
    // *p1 = 2;  // error
    p1 = nullptr;// ok

    int const *p2 = &k;
    // *p2 = 2;  // error
    p2 = nullptr;// ok

    int *const p3 = &k;
    *p3 = 2;     // ok
    // p3 = nullptr;// error
    cout << k << endl;

    const int *const p4 = &k;
    // *p4 = 3;  // error
    // p4 = nullptr; // error
}
```

### const ä¸ç±»

`const ` ä¿®é¥°ä¸€ä¸ªç±»å˜é‡ï¼Œæ¯”å¦‚ `const vector<int> v` ï¼Œé‚£ä¹ˆåœ¨ `v` çš„ç”Ÿå‘½å‘¨æœŸå†…ï¼Œä¸èƒ½è°ƒç”¨ `push_back` ç­‰ä¼šæ”¹å˜å†…éƒ¨çŠ¶æ€çš„å‡½æ•°ã€‚

ä¾‹å¦‚ï¼š

```cpp
class Test
{
public:
    int value;
    Test(int v = 0) : value(v) {}
    void func1() const {}
    void func2() {}
};
int main()
{
    const Test t; // å¿…é¡»æä¾›æ„é€ å‡½æ•°
    t.func1();
    t.func2();    // ç¼–è¯‘ä¸è¿‡
}
```



## volatile

volatile çš„ä¸»è¦ä½œç”¨æ˜¯**é¿å…ç¼–è¯‘ä¼˜åŒ–**ã€‚

volatile æ„ä¸ºä¸ç¨³å®šçš„ï¼Œè¯¥å…³é”®å­—çš„ä½œç”¨æ˜¯é¿å…ç¼–è¯‘å™¨å¯¹ä¿®é¥°å¯¹è±¡è¿›è¡Œç¼–è¯‘ä¼˜åŒ–ã€‚

è¢« `volatile` ä¿®é¥°çš„å˜é‡ï¼Œåœ¨å¯¹å…¶è¿›è¡Œè¯»å†™æ“ä½œæ—¶ï¼Œä¼šå¼•å‘ä¸€äº›**å¯è§‚æµ‹çš„å‰¯ä½œç”¨**ã€‚è€Œè¿™äº›å¯è§‚æµ‹çš„å‰¯ä½œç”¨ï¼Œæ˜¯ç”±**ç¨‹åºä¹‹å¤–çš„å› ç´ å†³å®šçš„**ã€‚

åœ¨ç¨‹åºå±‚é¢ï¼Œå…¶å…·ä½“ä½œç”¨æ˜¯ï¼švolatile å…³é”®å­—å£°æ˜çš„å˜é‡ï¼Œæ¯æ¬¡è®¿é—®æ—¶éƒ½å¿…é¡»ä»å†…å­˜ä¸­å–å‡ºå€¼ï¼ˆæ²¡æœ‰è¢« volatile ä¿®é¥°çš„å˜é‡ï¼Œå¯èƒ½ç”±äºç¼–è¯‘å™¨çš„ä¼˜åŒ–ï¼Œä» CPU å¯„å­˜å™¨ä¸­å–å€¼ï¼‰

```cpp
volatile uint32_t *port = 0xff800000;
// uint32_t *port = 0xff800000;
void init()
{
    for (int i=0; i<5; i++)
        *port = i;
}
```

å¦‚æœæ²¡æœ‰ `volatile` ä¿®é¥°çš„è¯ï¼Œä½¿ç”¨ `g++ -S volatile.cpp -O3` è¿›è¡Œç¼–è¯‘ï¼Œä»£ç å°±ä¼šè¢«ä¼˜åŒ–ä¸ºï¼š

```assembly
movl	_p, %eax
movl	$4, (%eax)
```

å¦‚æœæœ‰ `volatile` ä¿®é¥°ï¼ŒåŒæ ·çš„ç¼–è¯‘å‘½ä»¤ï¼š

```assembly
movl    $0, (%eax)
movl    $1, (%eax)
movl    $2, (%eax)
movl    $3, (%eax)
movl    $4, (%eax)
```

ä½†åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œç«¯å£å¿…é¡»ç»è¿‡æŸå‡ ä¸ªå€¼çš„åˆå§‹åŒ–ï¼Œç¼–è¯‘å™¨ç»™ä¼˜åŒ–æ‰ï¼Œé‚£ä¹ˆå‘ç”Ÿè¿™ç§äº‹æƒ…ï¼Œå¤§å®¶éƒ½ä¸æƒ³çš„ï¼Œè°èƒ½æƒ³åˆ°ç¼ºå¤±ä¸€ä¸ªå…³é”®å­—å°±æœ‰ BUG å‘¢ã€‚

å†æ¯”å¦‚ï¼Œ`port` æ˜¯ä¸€ä¸ªè¾“å‡ºç«¯å£ï¼Œç»™å¤–éƒ¨è®¾å¤‡æ˜¾ç¤ºä¸€ä¸ªå€’è®¡æ—¶ï¼Œè¿™ä¹Ÿæ˜¯å¿…é¡»è¦é¿å…ç¼–è¯‘ä¼˜åŒ–çš„æƒ…å†µã€‚



## decltype

åœ¨æ³›å‹ç¼–ç¨‹ (Generic Programming) ä¸­ç”¨äºæ¨å¯¼è¿”å›å€¼çš„ç±»å‹ã€‚

```cpp
template<typename T1, typename T2>
auto multiple(T1 a, T2 b) -> decltype(a*b)
{
    return a*b;
}
```

å¦‚æœè¢«å‡½æ•°æŒ‡é’ˆçš„å¥‡æ€ªå†™æ³•å›°æ‰°ï¼Œä¹Ÿèƒ½é€šè¿‡ `decltype` é¿å…è¿™ä¸€ã€Œå›°æ‰°ã€ï¼š

```cpp
void close_file(FILE *fp) { std::fclose(fp); }
unique_ptr<FILE, decltype(&close_file)> fp(fopen("demo.txt", "r"), &close_file);
```

## explict

- ä¿®é¥°æ„é€ å‡½æ•°ï¼šé˜²æ­¢éšå¼è½¬æ¢

```cpp
class A
{
public:
    int value;
    A(int v) : value(v) { cout << "A" << endl; }
};
class B
{
public:
    int value;
    explicit B(int v) : value(v) { cout << "B" << endl; }
};
int main()
{
    A a = 10;                // A
    cout << a.value << endl; // 10
    B b = 233;               // compile error
}
```



## friend 

å‹å…ƒæä¾›äº†ä¸€ç§æ™®é€šå‡½æ•°æˆ–è€…ç±»æˆå‘˜å‡½æ•°è®¿é—®å¦ä¸€ä¸ªç±»ä¸­çš„**ç§æœ‰æˆ–ä¿æŠ¤æˆå‘˜**çš„æœºåˆ¶ã€‚ä¹Ÿå°±æ˜¯è¯´æœ‰ä¸¤ç§å½¢å¼çš„å‹å…ƒï¼š

- å‹å…ƒå‡½æ•°ï¼šæ™®é€šå‡½æ•°å¯¹ä¸€ä¸ªè®¿é—®æŸä¸ªç±»ä¸­çš„ç§æœ‰æˆ–ä¿æŠ¤æˆå‘˜ã€‚
- å‹å…ƒç±»ï¼šç±» A ä¸­çš„æˆå‘˜å‡½æ•°è®¿é—®ç±» B ä¸­çš„ç§æœ‰æˆ–ä¿æŠ¤æˆå‘˜ã€‚

**å‹å…ƒå‡½æ•°**

```cpp
class A
{
    int value;

public:
    A(int v) : value(v) {}
    friend int get_value(const A &a);
};

int get_value(const A &a) { return a.value; }
int main()
{
    A a(233);
    cout << get_value(a) << endl; // 233
}
```

**å‹å…ƒç±»**

```cpp
class A
{
private: int value;
public:
    A(int v) : value(v) {}
    friend class B;
};
class B
{ public: static int get_value(const A &a) { return a.value; } };

class C : public B { };
int main()
{
    A a(233);
    cout << B::get_value(a) << endl;
    cout << C::get_value(a) << endl;
}
```

## virtual

ä¸»è¦ä½œç”¨å°±æ˜¯å£°æ˜ä¸€ä¸ª[è™šå‡½æ•°æˆ–è€…çº¯è™šå‡½æ•°](https://www.cnblogs.com/sinkinben/p/13775706.html)ã€‚

- `static` å‡½æ•°å¯ä»¥æ˜¯è™šå‡½æ•°å—ï¼Ÿ
  - ğŸ™…â€â™‚ï¸ ä¸å¯ä»¥ã€‚å› ä¸º `static` å‡½æ•°ä¸å±äºä»»ä½•å®ä¾‹å¯¹è±¡ï¼Œæ˜¯æ‰€æœ‰å¯¹è±¡å…±äº«çš„ã€‚
- æ„é€ å‡½æ•°å¯ä»¥ä¸ºè™šå‡½æ•°å—ï¼Ÿ
  - ğŸ™…â€â™‚ï¸ ä¸å¯ä»¥ã€‚æ„é€ å‡½æ•°åªèƒ½ç”¨ `inline/explicit` ä¿®é¥°ã€‚
- ææ„å‡½æ•°å¯ä»¥ä¸ºè™šå‡½æ•°å—ï¼Ÿ
  - ğŸ‰‘ï¸ å¯ä»¥ã€‚è¯·çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚ç”±æ­¤å¯ä»¥çœ‹å‡º**ææ„å‡½æ•°ä¸æ˜¯åŠ¨æ€ç»‘å®šçš„**ã€‚

```cpp
class Animal { public: ~Animal() { cout << "~Animal" << endl; } };
class Cat : public Animal
{
public:
    void whoami() { cout << "I am cat." << endl; }
    ~Cat() { cout << "~Cat" << endl; }
};
int main()
{
    Animal *ptr = new Cat();
    delete ptr; // ~Animal
}
```

å¦‚æœæŠŠ `Animal` çš„ææ„å‡½æ•°æ”¹ä¸º `virtual ~Animal() { ... }` ï¼Œ`delete ptr` å°†ä¼šè°ƒç”¨ `Cat` çš„ææ„å‡½æ•°ï¼Œå°†ä¼šè¾“å‡ºï¼š

```
~Cat
~Animal
```

 