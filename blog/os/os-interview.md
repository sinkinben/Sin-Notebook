## OS 面试题

整理日常遇到的 OS 面试题目。

## 线程和进程

线程隶属于某个进程，主要是拥有的资源的粒度不同。

下面的资源当中，进程独立拥有，而隶属同一进程的多个线程是可以共享的：

- 堆
- 全局变量和静态变量（即 DATA 段和 BSS 段）
- 文件描述符表

线程独立拥有的资源：

- 栈指针
- 寄存器：线程各有自己的寄存器数据的副本，包括程序计数器 (EIP)

## 进程的通信方式

- 管道
  - 匿名管道 (PIPE): 用于父子进程、兄弟进程之间。
  - 命名管道 (FIFO): 可作用于任意进程之间。Unix 中一切皆文件，所以 FIFO 管道也是一种特殊文件。可以通过 `mkfifo` 命令创建，库函数中也有 `mkfifo` 这一函数。
- 消息队列：消息的链接表，存放在内核中。一个消息队列由一个标识符（即队列 ID）来标识。
- 信号量 (semaphore)：用于多进程同步，而不是传递数据。
- 共享内存
- Socket
- 信号 (signal)



## 虚拟地址与物理地址的映射机制

段页式管理机制：虚拟地址 => 线性地址 => 物理地址（从 uCore 的实验手册盗的图）。

![](https://gitee.com/sinkinben/pic-go/raw/master/img/20210203210735.png)

## 缺页中断

缺页：某个虚拟地址转换后的物理地址不在内存当中，从磁盘上把这一页加载到内存。

CPU 访存顺序：寄存器，Cache，内存，外存（磁盘）。

过程如下图所示。

<img src="https://gitee.com/sinkinben/pic-go/raw/master/img/20210203211702.png" style="width:70%;" />



## OS 调度算法

先来先服务、短任务优先、优先级调度、多级反馈队列（不同队列不同优先级）、时间片轮转。



## 守护进程

守护进程（daemon）是生存期长的一种进程，没有控制终端。它们常常在系统引导装入时启动，仅在系统关闭时才终止。

通过 `ps` 查看，`[]` 包围起来的进程。

直观一点点的认知：用命令行输入启动程序，如果不是守护进程的话，一旦命令行窗口关闭，程序就终止了；而如果启动守护进程，则退出命令行窗口之后，服务一直处于运行状态。



## 孤儿进程与僵尸进程

孤儿进程：一个父进程退出，子进程将成为孤儿进程。孤儿进程将被 `init` 进程 (PID=1) 所收养，并由 `init` 进程对它们完成状态收集工作。

僵尸进程：`fork` 出来的子进程已经退出，但是父进程没有调用 `wait/waitpid` 获取状态信息，那么子进程依旧占用一个 `pid` 。



## 死锁的必要条件

- 互斥条件：一个资源每次只能被一个进程使用。
- 请求与保持条件：一个进程因请求资源而阻塞时，对已获得的资源保持不放。
- 不可抢占：进程已获得的资源，在末使用完之前，不能强行剥夺。
- 循环等待条件：若干进程之间形成一种头尾相接的循环等待资源关系。